<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
    Id="*"
    Name="SuperSlicer$(var.ReleaseSuffix)"
    Language="1033"
    Version="$(var.InstallerVersion)"
    Manufacturer="Supermerill"
    UpgradeCode="ee58a199-3c77-4865-bbe9-52b9cbb2bc32"
  >
    <Package
      InstallerVersion="500"
      Compressed="yes"
      InstallScope="perMachine"
      Description="SuperSlicer - Advanced 3D printing slicer"
      Comments="SuperSlicer installer package"
    />

    <MediaTemplate EmbedCab="yes" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="SuperSlicer"></Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="SuperSlicer" />
      </Directory>
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <Feature
      Id="DefaultFeature"
      Title="SuperSlicer Application"
      Level="1"
      Description="The main SuperSlicer application and required files."
    >
      <ComponentGroupRef Id="Package" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="DesktopShortcut" />
      <ComponentRef Id="CleanupComponent" />
    </Feature>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="*">
        <Shortcut
          Id="ApplicationStartMenuShortcut"
          Name="SuperSlicer"
          Description="Advanced 3D printing slicer"
          Target="[INSTALLFOLDER]superslicer.exe"
          WorkingDirectory="INSTALLFOLDER"
          Icon="SuperSlicerIcon.exe"
        />
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue
          Root="HKCU"
          Key="Software\SuperSlicer\StartMenu"
          Name="installed"
          Type="integer"
          Value="1"
          KeyPath="yes"
        />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="DesktopFolder">
      <Component Id="DesktopShortcut" Guid="*">
        <Shortcut
          Id="ApplicationDesktopShortcut"
          Name="SuperSlicer"
          Description="Advanced 3D printing slicer"
          Target="[INSTALLFOLDER]superslicer.exe"
          WorkingDirectory="INSTALLFOLDER"
          Icon="SuperSlicerIcon.exe"
        />
        <RegistryValue
          Root="HKCU"
          Key="Software\SuperSlicer\Desktop"
          Name="installed"
          Type="integer"
          Value="1"
          KeyPath="yes"
        />
      </Component>
    </DirectoryRef>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <UIRef Id="WixUI_InstallDir" />

    <WixVariable
      Id="WixUILicenseRtf"
      Value="$(var.SourceDir)\LICENSE.rtf"
      Overridable="yes"
    />

    <Icon
      Id="SuperSlicerIcon.exe"
      SourceFile="$(var.SourceDir)\superslicer.exe"
    />
    <Property Id="ARPPRODUCTICON" Value="SuperSlicerIcon.exe" />

    <DirectoryRef Id="INSTALLFOLDER">
      <Component Id="CleanupComponent" Guid="*">
        <RemoveFolder Id="INSTALLFOLDER" On="uninstall" />
        <RegistryKey
          Root="HKCU"
          Key="Software\SuperSlicer"
          ForceDeleteOnUninstall="yes"
        />
        <RegistryValue
          Root="HKCU"
          Key="Software\SuperSlicer\Cleanup"
          Name="installed"
          Type="integer"
          Value="1"
          KeyPath="yes"
        />
      </Component>
    </DirectoryRef>
  </Product>
</Wix>